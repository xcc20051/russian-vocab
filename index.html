<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¿„è¯­èƒŒå•è¯ Â· ä¸“ä¸šç‰ˆ</title>
<style>
    :root {
        --primary: #3498db; --secondary: #95a5a6; --accent: #e67e22;
        --error: #e74c3c; --success: #27ae60; --bg: #f4f6f8;
    }
    body {
        font-family: "Segoe UI", "PingFang SC", sans-serif;
        background: var(--bg); padding: 20px; color: #222;
        max-width: 800px; margin: 0 auto;
    }
    .header-box {
        background: white; padding: 20px; border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05); text-align: center; margin-bottom: 20px;
    }
    select {
        padding: 10px; font-size: 16px; width: 100%; max-width: 300px;
        border-radius: 8px; border: 2px solid #ddd; margin: 10px 0;
    }
    .controls {
        position: sticky; top: 10px; z-index: 100;
        background: white; padding: 15px; border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px;
        display: flex; flex-wrap: wrap; justify-content: center; gap: 8px;
    }
    button {
        background: var(--primary); color: white; border: none;
        padding: 10px 16px; border-radius: 8px; cursor: pointer;
        font-weight: bold; transition: 0.2s;
    }
    button:hover { opacity: 0.9; transform: translateY(-1px); }
    button.test-btn { background: var(--accent); }
    button.secondary { background: var(--secondary); }
    button.submit-btn { background: #2ecc71; width: 100%; margin: 20px 0; font-size: 18px; display: none; }

    .word {
        background: white; margin: 12px 0; padding: 20px;
        border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        display: flex; justify-content: space-between; align-items: center;
    }
    .left-part { flex: 1; }
    .ru { font-size: 24px; font-weight: bold; color: #2c3e50; margin-bottom: 5px; cursor: pointer;}
    .cn { color: var(--success); font-size: 18px; font-weight: 600; }
    
    .test-input {
        width: 100%; padding: 12px; font-size: 18px; border: 2px solid #ddd;
        border-radius: 8px; margin-top: 10px; box-sizing: border-box;
    }
    .diff-result {
        margin-top: 10px; padding: 12px; border-radius: 8px;
        background: #f8f9fa; display: none; line-height: 1.6;
    }
    .char-correct { color: var(--success); }
    .char-wrong { color: var(--error); text-decoration: underline; font-weight: bold; }
    .char-missing { color: #aaa; text-decoration: line-through; }
    
    .audio-btn {
        background: #f0f3f5; border-radius: 50%; width: 45px; height: 45px;
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; font-size: 20px; margin-left: 15px;
    }
    #wrongBookSection {
        display: none; background: #fff0f0; padding: 20px;
        border-radius: 12px; border: 2px solid var(--error); margin-top: 30px;
    }
</style>
</head>
<body>

<div class="header-box">
    <h1>ğŸ‡·ğŸ‡º ä¿„è¯­èƒŒå•è¯</h1>
    <select id="lessonSelect" onchange="initData()">
        <option value="all">ğŸ“š å…¨éƒ¨åˆ†æ•°ï¼ˆå¤ä¹ æ±‡æ€»ï¼‰</option>
        <option value="L1/1" selected>ç¬¬ 1/1 è¯¾</option>
        <option value="L1/2" selected>ç¬¬ 1/2 è¯¾</option>
        <option value="L1/3" selected>ç¬¬ 1/3 è¯¾</option>
        <option value="L2/1" selected>ç¬¬ 2/1 è¯¾</option>
        <option value="L2/2" selected>ç¬¬ 2/2 è¯¾</option>
        <option value="L2/3" selected>ç¬¬ 2/3 è¯¾</option>
        <option value="L3/1" selected>ç¬¬ 3/1 è¯¾</option>
        <option value="L3/2" selected>ç¬¬ 3/2 è¯¾</option>
        <option value="L3/3" selected>ç¬¬ 3/3 è¯¾</option>
        <option value="L4/1" selected>ç¬¬ 4/1 è¯¾</option>
        <option value="L4/2" selected>ç¬¬ 4/2 è¯¾</option>
        <option value="L4/3" selected>ç¬¬ 4/3 è¯¾</option>
        <option value="L10">ç¬¬ 10 è¯¾</option>
    </select>
</div>

<div class="controls">
    <button onclick="shuffleWords()">ğŸ”€ éšæœºä¹±åº</button>
    <button id="modeBtn" class="test-btn" onclick="toggleMode()">âœï¸ è¿›å…¥é»˜å†™æ¨¡å¼</button>
    <span id="viewCtrl">
        <button class="secondary" onclick="toggleAll(true)">ğŸ‘ï¸ æ˜¾</button>
        <button class="secondary" onclick="toggleAll(false)">ğŸ™ˆ éš</button>
    </span>
</div>

<div id="wordList"></div>

<button id="submitBtn" class="submit-btn" onclick="submitTest()">ğŸ“ æäº¤é˜…å·</button>

<div id="wrongBookSection">
    <h2 style="color: var(--error);">ğŸš© é”™é¢˜æœ¬</h2>
    <div id="wrongList"></div>
</div>

<script>
// 1. æ•°æ®é…ç½®åŒºï¼šåœ¨è¿™é‡Œæ·»åŠ ä½ çš„æ–°è¯¾ç¨‹
const allLessons = {
    "L3/1": [
        {ru: "ĞºĞ¾Ñ€Ğ¸Ğ´Ğ¾Ñ€", cn: "èµ°å»Š"}, {ru: "Ğ²ĞµÑ‰ÑŒ", cn: "ä¸œè¥¿ï¼›ç‰©å“"}, {ru: "Ğ´ĞµĞ¶ÑƒÑ€Ğ½Ñ‹Ğ¹", cn: "å€¼æ—¥ç”Ÿï¼›å€¼ç­äººå‘˜"},
        {ru: "", cn: ""}, {ru: "", cn: "ï¼›"}, {ru: "", cn: ""},
        {ru: "", cn: ""}, {ru: "", cn: "ï¼›"}, {ru: "", cn: ""},
        {ru: "", cn: ""}, {ru: "", cn: "ï¼›"}, {ru: "", cn: ""},
        {ru: "", cn: ""}, {ru: "", cn: "ï¼›"}, {ru: "", cn: ""},
        {ru: "", cn: ""}, {ru: "", cn: "ï¼›"}, {ru: "", cn: ""},
        {ru: "", cn: ""}, {ru: "", cn: "ï¼›"}, {ru: "", cn: ""},
        {ru: "", cn: ""}, {ru: "", cn: "ï¼›"}, {ru: "", cn: ""},
        {ru: "", cn: ""}, {ru: "", cn: "ï¼›"}, {ru: "", cn: ""},
        {ru: "", cn: ""}, {ru: "", cn: "ï¼›"}, {ru: "", cn: ""},
        {ru: "", cn: ""}, {ru: "", cn: "ï¼›"}, {ru: "", cn: ""},
        {ru: "", cn: ""}, {ru: "", cn: "ï¼›"}, {ru: "", cn: ""},
        {ru: "", cn: ""}, {ru: "", cn: "ï¼›"}, {ru: "", cn: ""},
        {ru: "", cn: ""}, {ru: "", cn: "ï¼›"}, {ru: "", cn: ""},
        {ru: "", cn: ""}, {ru: "", cn: "ï¼›"}, {ru: "", cn: ""}
    ],
    "L3/1": [
        {ru: "ÑƒÑ‚Ñ€Ğ¾", cn: "æ—©æ™¨"}, {ru: "Ñ‡Ğ°ÑÑ‹", cn: "é’Ÿï¼›å°æ—¶"}, {ru: "Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑÑ‚ÑŒ", cn: "æ£€æŸ¥(æœªå®Œæˆ)"},
        {ru: "Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ", cn: "æ£€æŸ¥(å®Œæˆ)"}, {ru: "Ñ‚Ğ¾Ñ‡Ğ½Ğ¾", cn: "å‡†ç¡®åœ°"}, {ru: "Ğ½ÑƒĞ¶Ğ½Ğ¾", cn: "éœ€è¦"},
        {ru: "Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ² â‰  Ğ±Ğ¾Ğ»ĞµĞ½", cn: "å¥åº· â‰  ç”Ÿç—…"}, {ru: "Ğ²Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑŒ â‰  Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑŒ", cn: "è¿›å…¥ â‰  å‡ºå»"},
        {ru: "Ğ²Ğ¿ĞµÑ€ĞµĞ´Ğ¸ â‰  ÑĞ·Ğ°Ğ´Ğ¸", cn: "å‰é¢ â‰  åé¢"}, {ru: "ĞºĞ¾Ğ½Ñ‡Ğ°Ñ‚ÑŒÑÑ â‰  Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ñ‚ÑŒÑÑ", cn: "ç»“æŸ â‰  å¼€å§‹"},
        {ru: "ÑĞ¿ĞµÑˆĞ¸Ñ‚ÑŒ", cn: "èµ¶æ—¶é—´"}, {ru: "Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°", cn: "è½¦ç«™"}, {ru: "Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°", cn: "å·¥ä½œ"},
        {ru: "Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹", cn: "å·¥äºº"}, {ru: "Ğ¾ÑĞµĞ½ÑŒ", cn: "ç§‹å¤©"}, {ru: "Ğ¾ÑĞµĞ½ÑŒÑ", cn: "åœ¨ç§‹å¤©"},
        {ru: "Ğ¾ÑĞµĞ½Ğ½Ğ¸Ğ¹", cn: "ç§‹å¤©çš„"}, {ru: "Ğ´ĞµĞ½ÑŒ", cn: "ç™½å¤©"}, {ru: "Ğ´Ğ¾Ğ¶Ğ´ÑŒ", cn: "é›¨"},
        {ru: "ÑĞ¾Ğ»Ğ½Ñ†Ğµ", cn: "å¤ªé˜³"}, {ru: "Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ", cn: "å¯èƒ½"}, {ru: "Ğ½Ğ°Ğ¿Ñ€Ğ¾Ñ‚Ğ¸Ğ²", cn: "å¯¹é¢"},
        {ru: "ÑĞ²ĞµÑ‚Ğ¸Ñ‚ÑŒ", cn: "ç…§è€€"}, {ru: "Ğ½ĞµĞ±Ğ¾", cn: "å¤©ç©º"}, {ru: "Ğ³Ğ¾Ğ»ÑƒĞ±Ğ¾Ğ¹", cn: "æµ…è“"},
        {ru: "Ğ·ĞµĞ»Ñ‘Ğ½Ñ‹Ğ¹", cn: "ç»¿è‰²"}, {ru: "Ğ¶Ñ‘Ğ»Ñ‚Ñ‹Ğ¹", cn: "é»„è‰²"}, {ru: "Ğ´ĞµÑ€ĞµĞ²Ğ¾ / Ğ´ĞµÑ€ĞµĞ²ÑŒÑ", cn: "æ ‘(å•/å¤)"},
        {ru: "ĞºÑƒĞ¿Ğ¸Ñ‚ÑŒ", cn: "ä¹°"}, {ru: "Ğ¾Ğ´ĞµĞ¶Ğ´Ğ°", cn: "è¡£æœ"}, {ru: "ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹", cn: "ç»æµçš„"},
        {ru: "ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸ÑÑ‚", cn: "ç»æµå­¦å®¶"}, {ru: "Ğ´Ñ€ÑƒĞ¶Ğ±Ğ°", cn: "å‹è°Š"}
    ],
    "L3/2": [
        {ru: "ĞºÑ€Ğ°ÑĞ½Ñ‹Ğ¹", cn: "çº¢è‰²çš„"}, {ru: "Ğ±ĞµĞ»Ñ‹Ğ¹", cn: "ç™½è‰²çš„"}, {ru: "Ñ‡Ñ‘Ñ€Ğ½Ñ‹Ğ¹", cn: "é»‘è‰²çš„"},
        {ru: "Ğ²ĞµĞ·Ğ´Ğµ", cn: "åˆ°å¤„"}, {ru: "Ğ·Ğ¸Ğ¼Ğ°", cn: "å†¬å¤©"}, {ru: "Ğ·Ğ¸Ğ¼Ğ¾Ğ¹", cn: "åœ¨å†¬å¤©"},
        {ru: "Ğ·Ğ¸Ğ¼Ğ½Ğ¸Ğ¹", cn: "å†¬å¤©çš„"}, {ru: "Ñ‚ĞµĞ¼Ğ¿ĞµÑ€Ğ°Ñ‚ÑƒÑ€Ğ°", cn: "æ¸©åº¦"}, {ru: "Ğ´Ğ°Ğ¶Ğµ", cn: "ç”šè‡³"},
        {ru: "Ğ¿Ğ°Ğ»ÑŒÑ‚Ğ¾", cn: "å¤§è¡£"}, {ru: "Ğ±Ğ¾Ñ‚Ğ¸Ğ½ĞºĞ¸", cn: "é´å­"}, {ru: "Ğ¿ĞµÑ€Ñ‡Ğ°Ñ‚ĞºĞ¸", cn: "æ‰‹å¥—"},
        {ru: "Ğ±ĞµĞ»ÑŒÑ‘", cn: "å†…è¡£"}, {ru: "Ñ‚ÑƒÑ„Ğ»Ğ¸", cn: "çš®é‹"}, {ru: "ÑˆĞ»ÑĞ¿Ğ°", cn: "å¸½å­"},
        {ru: "Ñ€ÑƒĞ±Ğ°ÑˆĞºĞ°", cn: "è¡¬è¡«"}, {ru: "ĞºĞ¾ÑÑ‚ÑĞ¼", cn: "è¥¿è£…ï¼›å¥—è£…"}, {ru: "Ğ¾Ğ±ÑƒĞ²ÑŒ", cn: "é‹ç±»"},
        {ru: "ÑĞ²Ğ¸Ñ‚ĞµÑ€", cn: "æ¯›è¡£"}, {ru: "ĞºÑƒÑ€Ñ‚ĞºĞ°", cn: "å¤¹å…‹ï¼›å¤–å¥—"}, {ru: "Ñ‚ĞºĞ°Ğ½ÑŒ", cn: "å¸ƒæ–™"},
        {ru: "Ğ¿Ğ¾ÑÑƒĞ´Ğ°", cn: "é¤å…·"}, {ru: "ÑƒĞ½Ğ¸Ğ²ĞµÑ€Ğ¼Ğ°Ğ³", cn: "ç™¾è´§å•†åº—"}, {ru: "ÑƒĞ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹", cn: "ç»¼åˆçš„ï¼›é€šç”¨çš„"},
        {ru: "Ğ¾Ñ‚Ğ´ĞµĞ»", cn: "æŸœå°ï¼›éƒ¨é—¨"}, {ru: "Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‡Ğ¸Ğº", cn: "ç¿»è¯‘ï¼ˆäººï¼‰"}, {ru: "Ğ´ĞµĞ½ÑŒĞ³Ğ¸", cn: "é’±"},
        {ru: "Ğ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚ÑŒ", cn: "ä»˜é’±ï¼ˆæœªå®Œæˆä½“ï¼‰"}, {ru: "Ğ·Ğ°Ğ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚ÑŒ", cn: "ä»˜å®Œé’±ï¼ˆå®Œæˆä½“ï¼‰"}, {ru: "Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°Ñ‚ÑŒ", cn: "ä¹°ï¼ˆæœªå®Œæˆä½“ï¼‰"},
        {ru: "ĞºÑƒĞ¿Ğ¸Ñ‚ÑŒ", cn: "ä¹°åˆ°ï¼ˆå®Œæˆä½“ï¼‰"}, {ru: "Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°Ñ‚ÑŒ", cn: "é€‰æ‹©ï¼ˆæœªå®Œæˆä½“ï¼‰"}, {ru: "Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ", cn: "é€‰å¥½ï¼ˆå®Œæˆä½“ï¼‰"},
        {ru: "Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ", cn: "å–ï¼ˆæœªå®Œæˆä½“ï¼‰"}, {ru: "Ğ¿Ñ€Ğ¾Ğ´Ğ°Ñ‚ÑŒ", cn: "å–æ‰ï¼ˆå®Œæˆä½“ï¼‰"}, {ru: "Ğ¸Ğ¼ĞµÑ‚ÑŒ", cn: "æœ‰"},
        {ru: "ÑƒÑÑ‚Ğ°Ğ²Ğ°Ñ‚ÑŒ", cn: "å˜ç´¯ï¼ˆæœªå®Œæˆä½“ï¼‰"}, {ru: "ÑƒÑÑ‚Ğ°Ñ‚ÑŒ", cn: "ç´¯äº†ï¼ˆå®Œæˆä½“ï¼‰"}
    ]
};

let currentWords = [];
let isTestMode = false;

// 2. åˆå§‹åŒ–æ•°æ®
function initData() {
    const val = document.getElementById('lessonSelect').value;
    if (val === 'all') {
        currentWords = Object.values(allLessons).flat();
    } else {
        currentWords = JSON.parse(JSON.stringify(allLessons[val]));
    }
    render();
}

// 3. æ¸²æŸ“é¡µé¢
function render() {
    const list = document.getElementById('wordList');
    list.innerHTML = '';
    currentWords.forEach((item, i) => {
        const div = document.createElement('div');
        div.className = 'word';
        if (!isTestMode) {
            div.innerHTML = `
                <div class="left-part" onclick="this.querySelector('.cn').style.display=this.querySelector('.cn').style.display==='none'?'block':'none'">
                    <div class="ru">${item.ru}</div>
                    <div class="cn" style="display:none">${item.cn}</div>
                </div>
                <div class="audio-btn" onclick="speak('${item.ru}')">ğŸ”Š</div>`;
        } else {
            div.innerHTML = `
                <div class="left-part">
                    <div class="cn">${item.cn}</div>
                    <input type="text" class="test-input" id="in-${i}" placeholder="è¾“å…¥ä¿„è¯­...">
                    <div id="df-${i}" class="diff-result"></div>
                </div>
                <div class="audio-btn" onclick="speak('${item.ru}')">ğŸ”Š</div>`;
        }
        list.appendChild(div);
    });
}

// 4. å®½å®¹çº é”™é€»è¾‘
function submitTest() {
    let wrongHTML = '';
    currentWords.forEach((item, i) => {
        const input = document.getElementById(`in-${i}`).value.trim();
        const target = item.ru;
        const resDiv = document.getElementById(`df-${i}`);
        resDiv.style.display = 'block';

        // å®½å®¹åŒ–å¤„ç†ï¼šè½¬å°å†™ï¼Œä¸”å»æ‰éå­—æ¯ç¬¦å·è¿›è¡Œå¯¹æ¯”
        const cleanIn = input.toLowerCase().replace(/[^Ğ°-ÑÑ‘]/g, '');
        const cleanTar = target.toLowerCase().replace(/[^Ğ°-ÑÑ‘]/g, '');

        if (cleanIn === cleanTar && cleanIn !== "") {
            resDiv.innerHTML = `<span class="char-correct">âœ“ æ­£ç¡®</span>`;
        } else {
            resDiv.innerHTML = `âŒ ${generateDiff(input, target)}<br><small>æ­£ç¡®ï¼š${target}</small>`;
            wrongHTML += `<div class="word"><div class="left-part"><div class="cn">${item.cn}</div><div class="ru">${item.ru}</div></div></div>`;
        }
    });

    if (wrongHTML) {
        document.getElementById('wrongBookSection').style.display = 'block';
        document.getElementById('wrongList').innerHTML = wrongHTML;
        window.scrollTo({top: document.body.scrollHeight, behavior:'smooth'});
    } else {
        alert("ğŸ‰ å…¨å¯¹ï¼å¤ªå‰å®³äº†ï¼");
    }
}

// 5. å·®å¼‚æ¯”å¯¹ç®—æ³•ï¼ˆå¯è§†åŒ–çº é”™ï¼‰
function generateDiff(user, target) {
    let res = "";
    const uArr = user.split('');
    const tArr = target.split('');
    const len = Math.max(uArr.length, tArr.length);
    for(let i=0; i<len; i++) {
        const u = uArr[i] || '';
        const t = tArr[i] || '';
        if (u.toLowerCase() === t.toLowerCase()) res += `<span class="char-correct">${u}</span>`;
        else if (!u) res += `<span class="char-missing">${t}</span>`;
        else res += `<span class="char-wrong">${u}</span>`;
    }
    return res;
}

// å…¶ä»–åŸºç¡€åŠŸèƒ½
function toggleMode() {
    isTestMode = !isTestMode;
    document.getElementById('modeBtn').innerText = isTestMode ? "ğŸ“– è¿”å›æµè§ˆæ¨¡å¼" : "âœï¸ è¿›å…¥é»˜å†™æ¨¡å¼";
    document.getElementById('viewCtrl').style.display = isTestMode ? 'none' : 'inline';
    document.getElementById('submitBtn').style.display = isTestMode ? 'block' : 'none';
    document.getElementById('wrongBookSection').style.display = 'none';
    render();
}

function shuffleWords() {
    currentWords.sort(() => Math.random() - 0.5);
    render();
}

function toggleAll(show) {
    document.querySelectorAll('.cn').forEach(el => el.style.display = show?'block':'none');
}

function speak(text) {
    const cleanText = text.replace(/[^Ğ°-ÑĞ-Ğ¯Ñ‘Ğ\s]/g, '');
    const msg = new SpeechSynthesisUtterance(cleanText);
    msg.lang = 'ru-RU';
    window.speechSynthesis.speak(msg);
}

initData();
</script>
</body>
</html>
